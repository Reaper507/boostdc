<html><head><title>Direct Connect Protocol Documentation</title></head><body text="#000000" link="#333333" vlink="#999999" alink="#FF0000">
<b><a href="http://www.teamfair.info/wiki/index.php">PLEASE USE Wiki INSTEAD</a></b>
<div align=right><font size=1><a href="javascript:alert('Page edited by Mutor for format, not content. 9/18/04');">Edit by Mutor</a></font></div><a name=Introduction></a> <h2>Introduction</h2><p><font size=2>I have compiled this protocol documentation from various sources in hopes of creating a complete Direct Connect protocol reference. </font><UL><font size=2><span class=variable>Version 1.4.1</span><br><span class=variable>Last Update 11/29/03</span> </font></UL><font size=2>The following users have contributed to this file.<br><br><b>Sid, aDe, Sedulus, David Marwood, Suxxx, Stefan Gorling, Sphinx &amp; HaArD</b> </font><p><font size=2> The Direct Connect network is composed of <i>Hubs</i>, <i>Clients</i>, and the <i>HubListServer</i>. Hubs listen on TCP port 411 and allow many clients to connect and exchange commands such as searches and chat messages. Essentially, hubs are a naming service and communication facilitator for clients. Clients store files and respond to searches against those files. The HubListServer acts as a naming service for all the hubs. All hubs register with the HubListServer and clients discover hubs by asking the HubListServer. Clients are run by users, each of whom has a nick (aka username). </font></p><p><font size=2>The TCP data is a series of commands, each in the form of,</font></p><UL><font size=2><span class=variable>&lt;command&gt;</span>| </font></UL><p><font size=2>The <span class=command>|</span> indicates the end of a command and is not followed by a newline.</font></p><font size=2>Certain users are designated as <i>Ops</i> by the hub and are able to issue certain commands not available to other users. </font><hr><a name=Contents></a><br><b><a href="#Contents">Table Of Contents</a></b><br><br><a href="#Introduction"><b>Introduction</b></a> -- Introduction<br><br><a href="#ClienttoClientHandShake"><b>Client2Client_Handshake</b></a> -- Client to Client HandShake<ul><li><font size=2><a href="#MyNick">$MyNick</a> </font><li><font size=2><a href="#Direction">$Direction</a> </font><li><font size=2><a href="#Send">$Send</a> </font><li><font size=2><a href="#DownloadExample">Download Example</a> </font></ul><a href="#ClienttoServerLogin"><b>Client2Server_Login</b></a> -- Client to Server Login<ul><li><a href="#DownloadExample2"><font size=2>Download Example</font></a></ul><a href="#ServertoHubRegistrationServer"><b>Server2RegServer_HubRegistration</b></a> -- Server to Hub Registration Server Communication<br><ul><li><a href="#Lock"><font size=2>$Lock</font></a><li><a href="#Key"><font size=2>$Key</font></a><li><a href="#HubRegistrationExample"><font size=2>Hub Registration Example</font></a></ul><a href="#CommandTypesclienttoclient"><b>Command_Types_(client_to_client)</b></a> -- Command Types (client to client)<br><ul><li><font size=2><a href="#GetListLen">$GetListLen</a> </font><li><font size=2><a href="#MaxedOut">$MaxedOut</a> </font><li><font size=2><a href="#Error">$Error</a> </font><li><font size=2><a href="#Get">$Get</a> </font><li><font size=2><a href="#FileLength">$FileLength</a> </font><li><font size=2><a href="#Canceled">$Canceled</a> </font></ul><ul><b><a href="#UDPClientToClientCommands">UDP Client To Client Commands</a> </b><ul><li><font size=2><a href="#SR">$SR</a> </font><li><font size=2><a href="#Ping">$Ping</a> </font></ul></ul><a href="#CommandTypesclienttoserver"><b>Command_Types_(client_to_server)</b></a> -- Command Types (client to server)<ul><li><font size=2><a href="#Hello">$Hello</a></font><li><font size=2><a href="#GetNickList">$GetNickList</a> </font><li><font size=2><a href="#MyINFO">$MyINFO (Client to Server)</a> </font><li><font size=2><a href="#GetINFO">$GetINFO</a> </font><li><font size=2><a href="#ConnectToMe">$ConnectToMe</a> </font><li><font size=2><a href="#MultiConnectToMe">$MultiConnectToMe</a> </font><li><font size=2><a href="#RevConnectToMe">$RevConnectToMe</a> </font><li><font size=2><a href="#To">$To</a> </font><li><font size=2><a href="#Quit">$Quit</a> </font><li><font size=2><a href="#OpForceMove">$OpForceMove</a> </font><li><font size=2><a href="#Kick">$Kick</a> </font><li><font size=2><a href="#SearchActiveclients">$Search (Active Clients)</a> </font><li><font size=2><a href="#SearchPassiveclients">$Search (Passive Clients)</a> </font><li><font size=2><a href="#MultiSearch">$MultiSearch</a> </font><li><font size=2><a href="#SRPassivesearchresult">$SR (Passive Search Result)</a> </font></ul><a href="#CommandTypesservertoserver"><b>Command_Types_(server_to_server)</b></a> -- Command Types (server to server)<br><ul><li><a href="#Up"><font size=2>$Up</font></a><li><a href="#Search2"><font size=2>$Search</font></a><li><a href="#ConnectToMe2"><font size=2>$ConnectToMe</font></a></ul><a href="#CommandTypesExperimental"><b>Command_Types_(experimental)</b></a> -- Command Types (experimental)<br><ul><li><a href="#MyINFO2"><font size=2>$MyINFO</font></a><li><a href="#SupportsBZList"><font size=2>$Supports BZList</font></a></ul><a href="#AppendixA"><b>Appendix_A</b></a> -- Converting a Lock into a Key<br><a href="#AppendixB"><b>Appendix_B</b></a> -- Creating a Lock<hr><a name=ClienttoClientHandShake></a><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Client to Client HandShake</h2> <a name=MyNick></a><h3>$MyNick</h3><p><font size=2>The listen User sends his Name when a user connecting.</font></p><UL><font size=2> $MyNick <span class=variable>&lt;ownnickname&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;ownnickname&gt;</span> is the nick of the user that sent to command.</font></li></ul><p><font size=2>The <span class=command>$Lock</span> is sent immediately after the <span class=command>$MyNick</span> command within the same packet.</font></p><UL><font size=2> $Lock <span class=variable>&lt;lock&gt;</span> Pk=<span class=variable>&lt;pk&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;lock&gt;</span> is used to generate <span class=variable>&lt;key&gt;</span><br>See <a href="#AppendixA">Appendix A: Converting a Lock into a Key</a> for how to compute the key from the lock. </font><li><font size=2><span class=variable>&lt;pk&gt;</span> is unused, but SG believes Pk stands for "private" or "public key". </font></ul><p><font size=2>Immediately following the <span class=command>$MyNick</span> + <span class=command>$Lock</span> packet the connecting user sends their <span class=command>$MyNick</span> + <span class=command>$Lock</span> in the same fashion as above.</font></p><a name=Direction></a> <h3>$Direction</h3><p><font size=2>The <span class=command>$Direction</span> command is a part of the response packet to the <span class=command>$Lock</span> + <span class=command>$MyNick</span> packet.</font></p><UL><font size=2> $Direction <span class=variable>&lt;direction&gt;</span> <span class=variable>&lt;anumber&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;direction&gt;</span> is either Upload or Download depending on if your client is uploading or downloading.</font></li><li><font size=2><span class=variable>&lt;anumber&gt;</span> is a random number, when both clients want to start downloading then one with higher number starts first.</font></li></ul><p><font size=2>After the <span class=command>$Direction</span> command we must send the <span class=command>$Key</span> command (still with in the <span class=command>$Direction</span> packet) in response to the other clients lock.</font></p><UL><font size=2> $Key <span class=variable>&lt;key&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;key&gt;</span> is generated from the other users <span class=variable>&lt;lock&gt;</span><br>See <a href="#AppendixA">Appendix A: Converting a Lock into a Key</a> for how to compute the key from the lock. </font></ul><p><font size=2>The users are now connected.</font></p><a name=Send></a><h3>$Send</h3><p><font size=2>The <span class=command>$Send</span> command informs the uploading client, that the download will start.</font></p><UL><font size=2> $Send </font></UL><p><font size=2>Direct Connect sends upload data in chunks of 40906 bytes. After every 40906 bytes is recived the downloading client must send the <span class=command>$Send</span> again.</font></p><hr><a name=DownloadExample></a><h3>Download Example:</h3><p><pre>
	Client <-> Client Communication in DC. 11-05-2002. By aDe 
	---------------------------------------------------------- 

	ACTIVE FILE DOWNLOAD 
	---------------------- 
	D = downloader 
	U = uploader 
	H = hub 

	D>H: $ConnectToMe <span class=variable>&lt;U's username&gt;</span> <span class=variable>&lt;D's IP and port&gt;</span>|
	H>U: $ConnectToMe <span class=variable>&lt;U's username&gt;</span> <span class=variable>&lt;D's IP and port&gt;</span>|
	U>D: Connection
	U>D: $MyNick <span class=variable>&lt;U's nick&gt;</span>|$Lock <span class=variable>&lt;new lock with pk&gt;</span>|
	D>U: $MyNick <span class=variable>&lt;D's nick&gt;</span>|$Lock <span class=variable>&lt;new lock with pk&gt;</span>|$Direction Upload <span class=variable>&lt;anumber&gt;</span>|$Key <span class=variable>&lt;key for U's lock&gt;</span>|
	U>D: $Direction Download <span class=variable>&lt;anumber&gt;</span>|$Key <span class=variable>&lt;key for D's lock&gt;</span>|
	D>U: $Get <span class=variable>&lt;filepath + filename in exact case&gt;</span>$<span class=variable>&lt;start at byte (1=beginning of file)&gt;</span>|
	U>D: $FileLength <span class=variable>&lt;length of the requested file&gt;</span>|
	D>U: $Send|
	U>D: Data, in many chunks.
	D>U: $Send|       <- when 40906 bytes are sent, ask for more
	</pre>
<hr><a name="ClienttoServerLogin"></a>
<p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;  </p>
<h2>Client to Server Login</h2>
<p><font size="2">When first logging in, the client creates a socket connection. 
  The server sends,</font></p>
<blockquote><font size="2"> $Lock <span class=variable>&lt;lock&gt;</span> Pk=<span class=variable>&lt;pk&gt;</span><br>
  $HubName <span class=variable>&lt;hubname&gt;</span> </font></blockquote>
<ul>
  <li><font size="2"><span class=variable>&lt;lock&gt;</span> is used to generate 
    <span class=variable>&lt;key&gt;</span><br>
    See <a href="#AppendixA.html">Appendix A: Converting a Lock into a Key</a> 
    for how to compute the key from the lock.</font></li>
  <li><font size="2"><span class=variable>&lt;pk&gt;</span> is unused, but SG 
    believes Pk stands for "private" or "public key".</font></li>
  <li><font size="2"><span class=variable>&lt;hubname&gt;</span> is the name of 
    the hub your connecting to (spaces permitted).</font></li>
</ul>
<p><font size="2">The client must then respond with,</font></p>
<blockquote><font size="2"> $Key <span class=variable>&lt;key&gt;</span><br>
  $ValidateNick <span class=variable>&lt;nick&gt;</span> </font></blockquote>
<ul>
  <li><font size="2"><span class=variable>&lt;key&gt;</span> is computed as above.</font></li>
  <li><font size="2"><span class=variable>&lt;nick&gt;</span> is the user's username.</font></li>
  <font size="2">All characters except $ and | and space are allowed (the NMDC 
  server converts any spaces to underscores and allows the login to proceed using 
  the corrected username). </font> 
</ul>
<p><font size="2">If <span class=variable>&lt;nick&gt;</span> is already in use 
  or is otherwise not accepted, the server must send,</font></p>
<blockquote><font size="2"> $ValidateDenide </font></blockquote>
<p><font size="2">It really is <span class=command>$ValidateDenide</span>, not 
  <span class=command>$ValidateDenied</span>. In this case, the client must send 
  <span class=command>$ValidateNick</span> again. Otherwise, the nick is accepted. 
  The server may then send,</font></p>
<blockquote><font size="2"> $GetPass </font></blockquote>
<p><font size="2">to which the client must reply,</font></p>
<blockquote><font size="2"> $MyPass <span class=variable>&lt;password&gt;</span> 
  </font></blockquote>
<ul>
  <li><font size="2"><span class=variable>&lt;password&gt;</span> is the plain-text 
    password for <span class=variable>&lt;nick&gt;</span>.</font></li>
</ul>
<p><font size="2">If the password is accepted <i>and the user is an Op</i>, the 
  server must send,</font></p>
<blockquote><font size="2"> $LogedIn </font></blockquote>
<font size="2">It really is <span class=command>$LogedIn</span>, not <span class=command>$LoggedIn</span>. 
If the user is not an Op, <span class=command>$LogedIn</span> is skipped.<br>
If the password is not accepted, the server must send, </font> 
<blockquote><font size="2"> $BadPass </font></blockquote>
<p><font size="2">and close the connection. NMDC hub answers with $HubIsFull even 
  before the nickname is sent. Other hub implementations usually wait until the 
  nickname is validated and then decide whether to let the user in or to disconnect 
  him.<br>
  If no password is required or the server accepts the password, the server must 
  finally send,</font></p>
<blockquote><font size="2"> $Hello <span class=variable>&lt;nick&gt;</span> </font></blockquote>
<ul>
  <li><font size="2"><span class=variable>&lt;nick&gt;</span> the clients nickname.</font></li>
</ul>
<p><font size="2">The user is now logged in.</font></p>
<hr>
<a name="DownloadExample2"></a><h3>Download Example:</h3>
<p> 
<pre>
	Client <-> Server Communication in DC. 01-26-2003. By Sid
	---------------------------------------------------------- 

	Client Hub Login Example
	---------------------- 
	C = client
	H = hub 

	C>H: Connection
	H>C: $Lock <span class=variable>&lt;lock&gt;</span> Pk=<span class=variable>&lt;pk&gt;</span>|
	H>C: $HubName <span class=variable>&lt;hubname&gt;</span>|
	C>H: $Key <span class=variable>&lt;key&gt;</span>|$ValidateNick <span class=variable>&lt;nick&gt;</span>|
	C>H: $MyINFO $ALL <span class=variable>&lt;nick&gt;</span> <span class=variable>&lt;interest&gt;</span>$ $<span class=variable>&lt;speed&gt;</span>$<span class=variable>&lt;e-mail&gt;</span>$<span class=variable>&lt;sharesize&gt;</span>$
	C>H: $GetINFO <span class=variable>&lt;othernick&gt;</span> <span class=variable>&lt;nick&gt;</span>
	C>H: $GetINFO...
	</pre><hr><a name=ServertoHubRegistrationServer></a><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Server to Hub Registration Server Communication</h2><p><font size=2>When first logging in, the server creates a socket connection. The hub registration server sends,</font></p><font size=2><a name=Lock></a> </font><UL><font size=2> $Lock <span class=variable>&lt;lock&gt;</span> Pk=<span class=variable>&lt;pk&gt;</span><br></font></UL><ul><li><font size=2><span class=variable>&lt;lock&gt;</span> is used to generate <span class=variable>&lt;key&gt;</span><br>See <a href="#AppendixA.html">Appendix A: Converting a Lock into a Key</a> for how to compute the key from the lock.</font></li><li><font size=2><span class=variable>&lt;pk&gt;</span> is unused, but SG believes Pk stands for "private" or "public key".</font></li></ul><p><font size=2>The server must then respond with,</font></p><a name=Key></a><UL><font size=2>$Key <span class=variable>&lt;key&gt;|&lt;hubname&gt;|&lt;hubaddress[:hubport]&gt;|&lt;hubdescription&gt;|&lt;hubusers&gt;|&lt;hubshare&gt;</span><br></font></UL><ul><li><font size=2><span class=variable>&lt;key&gt;</span> is computed as above.</font></li><li><font size=2><span class=variable>&lt;hubname&gt;</span> is the hubs's username.</font></li><li><font size=2><span class=variable>&lt;hubaddress[:hubport]&gt;</span> is the hubs's address. Optional <span class=variable>:hubport</span> if hub port is not 411.</font></li><li><font size=2><span class=variable>&lt;hubdescription&gt;</span> is the hubs's description.</font></li><li><font size=2><span class=variable>&lt;hubusers&gt;</span> is the total number of users in the hub.</font></li><li><font size=2><span class=variable>&lt;hubshare&gt;</span> is the total amount of data available in the hub (bytes).</font></li></ul><hr><a name=HubRegistrationExample></a> <h3>Hub Registration Example:</h3><p><pre>
	Server <-> Hub Registration Server Communication in DC. 04-29-2003. By Sid
	---------------------------------------------------------- 

	Hublist Registration
	---------------------- 
	R = hub registration server
	H = hub 

	H>R: Connection
	R>H: $Lock <span class=variable>&lt;lock&gt;</span> Pk=<span class=variable>&lt;pk&gt;</span>|
	H>R: $Key <span class=variable>&lt;key&gt;|&lt;hubname&gt;|&lt;hubaddress[:hubport]&gt;|&lt;hubdescription&gt;|&lt;hubusers&gt;|&lt;hubshare&gt;|</span><br>R>H: Connection Closed
	</pre><hr><a name=CommandTypesclienttoclient></a><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Command Types (client to client)</h2><p><font size=2>Direct Connect uses TCP and UDP for client to client communication.<br>Normaly the client listen at port 412 for client connections, but if the port already in use it uses 413,414 and so on..<br>The following section describes the format of the Commands, Each field is denoted with <span class=variable>&lt; &gt;</span>.<br>The fields in the command are separated by a single space character (ASCII 32).<br>And each Command ends with a | (pipe). All Commands are case sensitive.</font></p><a name=GetListLen></a><h3>$GetListLen</h3><p><font size=2>The downloading client sends the <span class=command>$GetListLen</span> to request the filesize of the remote DCList in bytes.</font></p><UL><font size=2> $GetListLen </font></UL><p><font size=2>The uploading client responds to the <span class=command>$GetListLen</span> command with <span class=command>$ListLen.</span></font></p><UL><font size=2> $ListLen <span class=variable>&lt;sizeinbyte&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;sizeinbyte&gt;</span> is the filesize of the remote DCList in bytes.</font></li></ul><a name=MaxedOut></a> <h3>$MaxedOut</h3><p><font size=2>The <span class=command>$MaxedOut</span> command is sent when there are no freeslots available from the uploading user.</font></p><UL><font size=2> $MaxedOut </font></UL><a name=Error></a><h3>$Error</h3><p><font size=2>The <span class=command>$Error</span> command is sent when an error occurs, like file not found.</font></p><UL><font size=2> $Error <span class=variable>&lt;errormessage&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;errormessage&gt;</span> is the message sent to the download client containing the error description.</font></li></ul><a name=Get></a> <h3>$Get</h3><p><font size=2>The <span class=command>$Get</span> command is used to request a file from the uploading client.</font></p><UL><font size=2> $Get <span class=variable>&lt;filenameandpath&gt;$&lt;resumecount&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;filenameandpath&gt;</span> is the remote location of the file requested.</font></li><li><font size=2><span class=variable>&lt;resumecount&gt;</span> is the byte offset to start at for resuming files.</font></li></ul><a name=FileLength></a> <h3>$FileLength</h3><p><font size=2>The <span class=command>$FileLength</span> is sent in response to the <span class=command>$Get</span> command.</font></p><UL><font size=2> $FileLength <span class=variable>&lt;sizeinbytes&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;sizeinbytes&gt;</span> is the file size in bytes of the file requested with the <span class=command>$Get</span> command.</font></li></ul><a name=Canceled></a> <h3>$Canceled</h3><p><font size=2>The <span class=command>$Canceled</span> command is sent by eather party signifying that the download has been canceled prematurly.</font></p><UL><font size=2> $Canceled </font></UL><a name=UDPClientToClientCommands></a> <h3>UDP Client To Client Commands</h3><p><font size=2>The following commands are the Client To Client UDP Commands.</font></p><a name=SR></a><h3>$SR</h3><p><font size=2>The <span class=command>$SR</span> command is sent in response to a client searching. This is sent UDP when the searching client is in Active Mode.</font></p><UL><font size=2> $SR <span class=variable>&lt;nick&gt; &lt;searchresponse&gt; &lt;hubip&gt;:&lt;hubport&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the nick of the user with the file.</font></li><li><font size=2><span class=variable>&lt;hubip&gt;:&lt;hubport&gt;</span> are the values sent in the <span class=command>$Search</span> command.</font></li></ul><p><font size=2><span class=variable>&lt;searchresponse&gt;</span> is made up of</font></p><UL><font size=2><span class=variable>&lt;filenamewithpath&gt;&#5;&lt;filesizeinbytes&gt; &lt;current openslots&gt;/&lt;allopenslots&gt;&#5;&lt;hubname&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;filenamewithpath&gt;</span> is the location of the file on the remote client.</font></li><li><font size=2><span class=variable>&lt;filesizeinbytes&gt;</span> is the size of the file found.</font></li><li><font size=2><span class=variable>&lt;current openslots&gt;</span> is the number of free slots the remote client has available.</font></li><li><font size=2><span class=variable>&lt;allopenslots&gt;</span> is the total number of slots the remote client has available.</font></li><li><font size=2><span class=variable>"&#5;"</span> is the ascii character 5.</font></li></ul><p><font size=2>Note: <span class=command>$SR</span> is the only command that does not end in a "|".</font></p><a name=Ping></a><h3>$Ping</h3><p><font size=2>I'm not sure what the purpose of this command.</font></p><UL><font size=2> $Ping <span class=variable>&lt;senderIp&gt;:&lt;senderPort&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;senderIp&gt;</span> is the Ip address of the client sending the command.</font></li><li><font size=2><span class=variable>&lt;senderPort&gt;</span> is the UDP port the client is listening on (Usually the same as TCP port).</font></li></ul><hr><a name=CommandTypesclienttoserver></a><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Command Types (client to server)</h2><p><font size=2>Direct Connect uses TCP for client to server communication.<br>The following section describes the format of the Commands, Each field is denoted with <span class=variable>&lt; &gt;</span>.<br>The fields in the command are separated by a single space character (ASCII 32).<br>And each Command ends with a <span class=command>|</span> (pipe). All Commands are case sensitive.</font></p><a name=Hello></a> <h3>$Hello</h3><p><font size=2>Shortly after a new user, <span class=variable>&lt;nick&gt;</span> logs in, the server must send,</font></p><UL><font size=2> $Hello <span class=variable>&lt;nick&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the nick of a recently logged in user.</font></li></ul><p><font size=2>This indicates <span class=variable>&lt;nick&gt;</span> has logged in. If the new user is an operator, the server must additionally send a <span class=command>$OpList</span> command to all users (documented at <span class=command>$GetNickList</span>).</font></p><p><font size=2>Each client should add <span class=variable>&lt;nick&gt;</span> to its list of hub users and, if <span class=command>$OpList</span> is also received, update its list of operators. The new client must reply:</font></p><UL><font size=2> $Version <span class=variable>&lt;version&gt;</span><br></font></UL><ul><li><font size=2><span class=variable>&lt;version&gt;</span> is <b>1.0091</b> by default.</font></li></ul><a name=GetNickList></a><h3>$GetNickList</h3><p><font size=2>To obtain a list of other users' nicks, the client may send,</font></p><UL><font size=2> $GetNickList </font></UL><p><font size=2>to which the server must reply,</font></p><UL><font size=2> $NickList <span class=variable>&lt;nick1&gt;</span>$$<span class=variable>&lt;nick2&gt;</span>$$<span class=variable>&lt;nick3&gt;</span>$$...<br>$OpList <span class=variable>&lt;op1&gt;</span>$$<span class=variable>&lt;op2&gt;</span>$$<span class=variable>&lt;op3&gt;</span>$$... </font></UL><ul><li><font size=2><span class=variable>&lt;nick1&gt;</span>, <span class=variable>&lt;nick2&gt;</span>, <span class=variable>&lt;nick3&gt;</span>, ... compose a $$-separated list of hub users' nicks (including operators). After the final nick there is a <span class=command>$$</span>.</font></li><li><font size=2><span class=variable>&lt;op1&gt;</span>$$<span class=variable>&lt;op2&gt;</span>$$<span class=variable>&lt;op3&gt;</span>$$... is a $$-separated list of connected users that are operators. After the final nick there is a <span class=command>$$</span>. This list is a subset of the <span class=command>$NickList</span>. If there are no connected operators, the server must send "<span class=command>$OpList </span>"</font></li></ul><p><font size=2>If a client receives a <span class=command>$OpList</span> command listing its own nick, it should enable the "Redirect User" and "Kick" functions.</font></p><a name=MyINFO></a><h3>$MyINFO (Client to Server)</h3><p><font size=2>Shortly after logging in, the client must send,</font></p><UL><font size=2> $MyINFO $ALL <span class=variable>&lt;nick&gt;</span> <span class=variable>&lt;interest&gt;</span>$ $<span class=variable>&lt;speed&gt;</span>$<span class=variable>&lt;e-mail&gt;</span>$<span class=variable>&lt;sharesize&gt;</span>$ </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the client's nick.</font></li><li><font size=2><span class=variable>&lt;interest&gt;</span> is a string describing the user's interest and may be empty (All characters except $ and | are allowed).</font></li><li><font size=2><span class=variable>&lt;speed&gt;</span> is a string describing the client's internet connection selected from "56Kbps", "Satellite", "DSL", "Cable", "LAN(T1)", and "LAN(T3)" followed by a byte indicating the speed class. The value of the byte is selected from at least 1 for 56Kbps, 3 for cable or DSL, or 7, also for DSL.</font></li><li><font size=2><span class=variable>&lt;e-mail&gt;</span> is nick's e-mail address and may be "".</font></li><li><font size=2><span class=variable>&lt;sharesize&gt;</span> is the number of bytes this client shares as a string.</font></li></ul><p><font size=2>The max size of the description is chosen by the hub implementation. (see $ValidateNick in <a href="Client2Server_Login.html">Client to Server Login</a>)<br>NOTE: some hub implementations do not consider a client to be in a logged in state before it has sent a <span class=command>$MyINFO</span>. this is the correct behaviour, and the NMDC hub is flawed in this respect.</font></p><p><font size=2>The server must pass this message to all users of the hub, including the sender. The client is expected to send this again if the information changes. SX says that the last byte of the speed is selected from the ascii values of 1 for normal, 2 for away, 3 also for away, 4 for fileserver, 5 also for fileserver, 6 for fileserver away, 7 also for fileserver away, 8 for fireball, 9 also for fireball, 10 for fireball away, and 11 also for fireball away.</font></p><font size=2><a name=GetINFO></a></font> <h3>$GetINFO</h3><p><font size=2>To obtain detailed information about a specific user, the client may send,</font></p><UL><font size=2> $GetINFO <span class=variable>&lt;othernick&gt;</span> <span class=variable>&lt;nick&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is this sending client's nick.</font></li><li><font size=2><span class=variable>&lt;othernick&gt;</span> is the nick of the user that <span class=variable>&lt;nick&gt;</span> wants to know about.</font></li></ul><p><font size=2>The server must respond with exactly the <span class=command>$MyINFO</span> command sent by <span class=variable>&lt;othernick&gt;</span> to the server. I don't know what to do if <span class=variable>&lt;othernick&gt;</span> has not sent a <span class=command>$MyINFO</span> command (perhaps he would have never been listed in <span class=command>$GetNickList</span>, in which case the command could be rejected). I don't know what to do if <span class=variable>&lt;othernick&gt;</span> doesn't exist.</font></p><a name=ConnectToMe></a><h3>$ConnectToMe</h3><p><font size=2>The client may send <span class=command>$ConnectToMe</span> to cause a peer to initiate a peer-to-peer connection for the purpose of transfering data.</font></p><UL><font size=2> $ConnectToMe <span class=variable>&lt;remoteNick&gt;</span> <span class=variable>&lt;senderIp&gt;</span>:<span class=variable>&lt;senderPort&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;senderIp&gt;</span> and <span class=variable>&lt;senderPort&gt;</span> are the host and port that the client wishes <span class=variable>&lt;remoteNick&gt;</span> to connect to.</font></li><li><font size=2><span class=variable>&lt;remoteNick&gt;</span> is the remote user that should initiate the connection.</font></li></ul><p><font size=2>The server sends this message unaltered to <span class=variable>&lt;remotenick&gt;</span>. <span class=variable>&lt;remotenick&gt;</span> must open a TCP connection to <span class=variable>&lt;senderIp&gt;</span>:<span class=variable>&lt;senderPort&gt;</span></font>.</p><a name=MultiConnectToMe></a><h3>$MultiConnectToMe</h3><p><font size=2>The client may send this instead of the <span class=command>$ConnectToMe</span> to cause a peer on another hub to initiate a peer-to-peer connection for the purpose of transfering data. This is an extension for multiple hubs, which I'm not worried about yet.</font></p><UL><font size=2> $MultiConnectToMe <span class=variable>&lt;nick&gt;</span> <span class=variable>&lt;senderIp&gt;</span>:<span class=variable>&lt;senderPort&gt;</span> <span class=variable>&lt;linkedserverip&gt;</span>:<span class=variable>&lt;linkedserverport&gt;</span> </font></UL><a name=RevConnectToMe></a><h3>$RevConnectToMe</h3><p><font size=2>A passive client may send this to cause a peer to send a <span class=command>$ConnectToMe</span> back.</font></p><UL><font size=2> $RevConnectToMe <span class=variable>&lt;nick&gt;</span> <span class=variable>&lt;remoteNick&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the sender of the message.</font></li><li><font size=2><span class=variable>&lt;remoteNick&gt;</span> is the user which should send to <span class=command>$ConnectToMe</span>.</font></li></ul><p><font size=2>The server must send this message unmodified to <span class=variable>&lt;remoteNick&gt;</span>. If <span class=variable>&lt;remoteNick&gt;</span> is an active client, it must send a <span class=command>$ConnectToMe</span> to <span class=variable>&lt;nick&gt;</span>. If not, it will reply with <span class=command>$RevConnectToMe</span>. The clients will no longer connect to each other because they are both in passive mode. </font></p><a name=To></a><h3>$To</h3><p><font size=2>The client may send <span class=command>$To</span> to send a private message to a peer.</font></p><UL><font size=2> $To: <span class=variable>&lt;othernick&gt;</span> From: <span class=variable>&lt;nick&gt;</span> $&lt;<span class=variable>&lt;nick&gt;</span>&gt; <span class=variable>&lt;message&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;othernick&gt;</span> is the peer who should receive the message.</font></li><li><font size=2><span class=variable>&lt;nick&gt;</span> is the sender's nick (both instances).</font></li><li><font size=2><span class=variable>&lt;message&gt;</span> is the text of the message (spaces permitted).</font></li></ul><p><font size=2>The server must pass the message unmodified to client <span class=variable>&lt;othernick&gt;</span> which must display the message to the user.</font></p><h3>&lt; &gt;</h3><p><font size=2>The client may send <span class=variable>&lt; &gt;</span> to send a public chat message to all hub users.</font></p><UL><font size=2>&lt;<span class=variable>&lt;nick&gt;</span>&gt; <span class=variable>&lt;message&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is this sender's nick.</font></li></ul><p><font size=2>The server must pass the message unmodified to all other clients including <span class=variable>&lt;nick&gt;</span>.</font></p><a name=Quit></a><h3>$Quit</h3><p><font size=2>The hub should send <span class=command>$Quit</span> to all users in the hub to let them know the users has disconnected.</font></p><UL><font size=2> $Quit <span class=variable>&lt;nick&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the sender's nick.</font></li></ul><p><font size=2>The client must then close the socket. The server must send this message to all users when it is received from a client, or when a client connection is lost. Each client should remove <span class=variable>&lt;nick&gt;</span> from its list of hub users.</font></p><a name=OpForceMove></a><h3>$OpForceMove</h3><p><font size=2>An op may send a <span class=command>$OpForceMove</span> to cause a client to move to a different server.</font></p><UL><font size=2> $OpForceMove $Who:<span class=variable>&lt;victimNick&gt;</span>$Where:<span class=variable>&lt;newIp&gt;</span>$Msg:<span class=variable>&lt;reasonMsg&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;victimNick&gt;</span> is the nick that will be asked to move.</font></li><li><font size=2><span class=variable>&lt;newHub&gt;</span> is the IP address (and optional colon-separated port) of another hub that the user should move to.</font></li><li><font size=2><span class=variable>&lt;reasonMsg&gt;</span> is the reason provided to <span class=variable>&lt;victimNick&gt;</span>.</font></li></ul><p><font size=2>On receiving this, the server must send to <span class=variable>&lt;victimNick&gt;</span>,</font></p><UL><font size=2> $ForceMove <span class=variable>&lt;newIp&gt;</span><br>$To: <span class=variable>&lt;victimNick&gt;</span> From: <span class=variable>&lt;senderNick&gt;</span> $&lt;<span class=variable>&lt;senderNick&gt;</span>&gt; You are being re-directed to <span class=variable>&lt;newHub&gt;</span> because: <span class=variable>&lt;reasonMsg&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;senderNick&gt;</span> is the nick that sent the <span class=command>$OpForceMove</span>.</font></li></ul><p><font size=2>In addition to displaying the message, <span class=variable>&lt;victimNick&gt;</span> must disconnect from the server and connect to <span class=variable>&lt;newIp&gt;</span>. The server should not disconnect the client. I'm not sure if the client should send <span class=command>$Quit</span> or if it should simply close the socket.</font></p><a name=Kick></a><h3>$Kick</h3><p><font size=2>Ops may send <span class=command>$Kick</span> to cause the hub to disconnect a user.</font></p><UL><font size=2> $Kick <span class=variable>&lt;victimNick&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;victimNick&gt;</span> is the nick of the user to disconnect.</font></li></ul><p><font size=2>The server must disconnect <span class=variable>&lt;victimNick&gt;</span>. The user is notified with the <span class=command>$To</span> command.</font></p><a name=SearchActiveclients></a><h3>$Search - Active clients</h3><p><font size=2>Clients are either "active", indicating they are on the Internet and can receive data directly from peers, or "passive", in which case they can communicate only through the existing connection to the server. To perform a search, an active client can send,</font></p><UL><font size=2> $Search <span class=variable>&lt;clientip&gt;</span>:<span class=variable>&lt;clientport&gt;</span> <span class=variable>&lt;searchstring&gt;</span><br>i.e. $Search 64.78.55.32:412 T?T?500000?1?madonna$ray </font></UL><ul><li><font size=2><span class=variable>&lt;clientip&gt;</span> is this client's IP address.</font></li><li><font size=2><span class=variable>&lt;clientport&gt;</span> is a UDP port on which the client is listening for responses.</font></li><li><font size=2><span class=variable>&lt;searchstring&gt;</span> is a string describing the file the client is searching for.</font></li></ul><p><font size=2><span class=variable>&lt;searchstring&gt;</span> is made up of</font></p><UL><font size=2><span class=variable>&lt;sizerestricted&gt;</span>?<span class=variable>&lt;isminimumsize&gt;</span>?<span class=variable>&lt;size&gt;</span>?<span class=variable>&lt;datatype&gt;</span>?<span class=variable>&lt;searchpattern&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;sizerestricted&gt;</span> is <span class=command>T</span> if the search should be restricted to files of a minimum or maximum size, otherwise <span class=command>F</span>.</font></li><li><font size=2><span class=variable>&lt;isminimumsize&gt;</span> is <span class=command>F</span> if <span class=variable>&lt;sizerestricted&gt;</span> is <span class=command>F</span> or if the size restriction places an upper limit on file size, otherwise <span class=command>T</span>.</font></li><li><font size=2><span class=variable>&lt;size&gt;</span> is the minimum or maximum size of the file to report (according to <span class=variable>&lt;isminimumsize&gt;</span>) if <span class=variable>&lt;sizerestricted&gt;</span> is <span class=command>T</span>, otherwise 0.</font></li><li><font size=2><span class=variable>&lt;datatype&gt;</span> restricts the search to files of a particular type. It is an integer selected from: </font><ul><li><font size=2>1 for any file type</font></li><li><font size=2>2 for audio files ("mp3", "mp2", "wav", "au", "rm", "mid", "sm")</font></li><li><font size=2>3 for compressed files ("zip", "arj", "rar", "lzh", "gz", "z", "arc", "pak")</font></li><li><font size=2>4 for documents ("doc", "txt", "wri", "pdf", "ps", "tex")</font></li><li><font size=2>5 for executables ("pm", "exe", "bat", "com")</font></li><li><font size=2>6 for pictures ("gif", "jpg", "jpeg", "bmp", "pcx", "png", "wmf", "psd")</font></li><li><font size=2>7 for video ("mpg", "mpeg", "avi", "asf", "mov")</font></li><li><font size=2>8 for folders</font></li></ul><li><font size=2><span class=variable>&lt;searchpattern&gt;</span> is used other users to determine if any files match. It is of the form: </font><UL><font size=2><span class=variable>&lt;term1&gt;</span>$<span class=variable>&lt;term2&gt;</span>$<span class=variable>&lt;term3&gt;</span>$...$ </font></UL><font size=2>where <span class=variable>&lt;term1&gt;</span>, <span class=variable>&lt;term2&gt;</span>, ... are search terms; normally, each search term is a space-delimited word entered by the user. Each search term is followed by a <span class=command>$</span>, and after the last search term there is a total of two <span class=command>$</span>. </font></li></ul><p><font size=2>The server must forward this message unmodified to all the other users. Every other user with one or more matching files must send one UDP packet to <span class=variable>&lt;clientip&gt;</span>:<span class=variable>&lt;clientport&gt;</span> for each match containing just the message,</font></p><UL><font size=2> $SR <span class=variable>&lt;nick&gt;</span> <span class=variable>&lt;searchresponse&gt;</span> <span class=variable>&lt;hubip&gt;</span>:<span class=variable>&lt;hubport&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the nick of the user with the file.</font></li><li><font size=2><span class=variable>&lt;hubip&gt;</span>:<span class=variable>&lt;hubport&gt;</span> are the values sent in the $Search command.</font></li></ul><p><font size=2><span class=variable>&lt;searchresponse&gt;</span> is made up of</font></p><UL><font size=2><span class=variable>&lt;filenamewithpath&gt;&#5;&lt;filesizeinbytes&gt; &lt;current openslots&gt;/&lt;allopenslots&gt;&#5;&lt;hubname&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;filenamewithpath&gt;</span> is the location of the file on the remote client.</font></li><li><font size=2><span class=variable>&lt;filesizeinbytes&gt;</span> is the size of the file found.</font></li><li><font size=2><span class=variable>&lt;current openslots&gt;</span> is the number of free slots the remote client has available.</font></li><li><font size=2><span class=variable>&lt;allopenslots&gt;</span> is the total number of slots the remote client has available.</font></li><li><font size=2><span class=variable>"&#5;"</span> is the ascii character 5.</font></li></ul><p><font size=2>Note: When the client sends the <span class=command>$SR</span> command to the server it adds <span class=variable>&#5;&lt;ClientsNick&gt;</span> to the end of <span class=variable>&lt;searchresponse&gt;</span>.</font></p><a name=SearchPassiveclients></a> <h3>$Search - Passive clients</h3><p>To search the network for files matching a search term, a passive client may send,</p><UL>$Search Hub:<span class=variable>&lt;searchingNick&gt;</span> <span class=variable>&lt;searchstring&gt;</span></UL><p>The server must forward this message unmodified to all the other users. Every other user with one or more matching files must send to the server,</p><UL>$SR <span class=variable>&lt;resultNick&gt;</span> <span class=variable>&lt;filepath&gt;</span>&#5;<span class=variable>&lt;filesize&gt;</span> <span class=variable>&lt;freeslots&gt;</span>/<span class=variable>&lt;totalslots&gt;</span>&#5;<span class=variable>&lt;hubname&gt;</span> (<span class=variable>&lt;hubhost&gt;</span>[:<span class=variable>&lt;hubport&gt;</span>])^E<span class=variable>&lt;searchingNick&gt;</span></UL><ul><li><span class=variable>&lt;resultNick&gt;</span> is the nick of the user reporting the result.</li><li><span class=variable>&lt;filepath&gt;</span> is the path and file name of the matching file on <span class=variable>&lt;resultNick&gt;</span>'s computer. Eventually, <span class=variable>&lt;searchingNick&gt;</span> will pass this string unmodified to <span class=variable>&lt;resultNick&gt;</span> to download the file.</li><li><span class=variable>&lt;filesize&gt;</span> is the integer size of the file in bytes.</li><li><span class=variable>&lt;freeslots&gt;</span> and <span class=variable>&lt;totalslots&gt;</span> is <span class=variable>&lt;resultNick&gt;</span>'s number of free slots and total slots, respectively.</li><li><span class=variable>&lt;hubname&gt;</span> is the name of the hub from which the query arrived.</li><li><span class=variable>&lt;hubhost&gt;</span> and <span class=variable>&lt;hubport&gt;</span> are the hostname and port of the hub as perceived by <span class=variable>&lt;resultNick&gt;</span> (if :<span class=variable>&lt;hubport&gt;</span> is omitted, it is taken to be 411).</li><li><span class=variable>&lt;searchingNick&gt;</span> is the nick that initiated the search and is the same as in the $Search command.</li><li><span class=command>&#5;</span> is the ascii character 5.</li></ul><p>The server must pass the <span class=command>$SR</span> message unmodified to <span class=variable>&lt;searchingNick&gt;</span>.</p><a name=MultiSearch></a><h3>$MultiSearch</h3><p><font size=2>This is takes the same parameters as <span class=command>$Search</span> (both active and passive) and behaves exactly as <span class=command>$Search</span>, except the hub must additionally pass the search request to the other hubs in the cluster using the hub-to-hub <span class=command>$Search</span> command.</font></p><a name=SRPassivesearchresult></a> <h3>$SR - Passive search result</h3><p><font size=2>Replies to passive search requests are sent through the server. Compare the <span class=command>$SR</span> in <a href="Command_Types_(client_to_client).html">Command Types (client to client)</a>. </font><UL><font size=2> $SR <span class=variable>&lt;replynick&gt;</span> <span class=variable>&lt;searchresponse&gt;</span>&#5;<span class=variable>&lt;searchnick&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;replynick&gt;</span> is the nick of the user with the file.</font></li><li><font size=2><span class=variable>&lt;searchnick&gt;</span> is the nick of the user who did the query.</font></li><li><font size=2><span class=command>&#5;</span> is the ascii character 5.</font></li></ul><p><font size=2><span class=variable>&lt;searchresponse&gt;</span> is made up of</font></p><UL><font size=2><span class=variable>&lt;filenamewithpath&gt;</span>&#5;<span class=variable>&lt;filesizeinbytes&gt;</span> <span class=variable>&lt;current openslots&gt;</span>/<span class=variable>&lt;allopenslots&gt;</span>&#5;<span class=variable>&lt;hubname&gt;</span> (<span class=variable>&lt;hubip&gt;</span>) </font></UL><ul><li><font size=2><span class=variable>&lt;filenamewithpath&gt;</span> is the location of the file on the remote client.</font></li><li><font size=2><span class=variable>&lt;filesizeinbytes&gt;</span> is the size of the file found.</font></li><li><font size=2><span class=variable>&lt;current openslots&gt;</span> is the number of free slots the remote client has available.</font></li><li><font size=2><span class=variable>&lt;allopenslots&gt;</span> is the total number of slots the remote client has available.</font></li><li><font size=2><span class=variable>&lt;hubname&gt;</span> is the name of the hub on which the respondent recieved the passive search request.</font></li><li><font size=2><span class=variable>&lt;hubip&gt;</span> is the IP address of the hub. Note that is does not have a port number (at least DC++ does not send one).</font></li><li><font size=2><span class=command>&#5;</span> is the ascii character 5.</font></li></ul><font size=2>The search result should be forwarded to <span class=variable>&lt;searchnick&gt;</span>, but without the <span class=command>&#5;</span><span class=variable>&lt;searchnick&gt;</span> at the end. </font><hr><a name=CommandTypesservertoserver></a><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Command Types (server to server)</h2><p><font size=2>Direct Connect uses UDP for server to server communication.<br>The following section describes the format of the Commands. Each field is denoted with <span class=variable>&lt; &gt;</span>.<br>The fields in the command are separated by a single space character (ASCII 32).<br>And each Command ends with a <span class=command>|</span> (pipe). All Commands are case sensitive.</font></p><a name=Up></a><h3>$Up</h3><p><font size=2>This message will be sent to each linked server.</font></p><UL><font size=2> $Up <span class=variable>&lt;linkedserverpassword&gt;</span> <span class=variable>&lt;ownip&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;linkedserverpassword&gt;</span> is the multi-hub searching password shared by linked hubs.</font></li><li><font size=2><span class=variable>&lt;ownip&gt;</span> is the ip address of the hub sending the command.</font></li></ul><p><font size=2>The server receiving the <span class=command>$Up</span> command must then respond with</font></p><UL><font size=2> $UpToo <span class=variable>&lt;linkedserverpassword&gt;</span> <span class=variable>&lt;ownip&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;linkedserverpassword&gt;</span> is the multi-hub searching password shared by linked hubs.</font></li><li><font size=2><span class=variable>&lt;ownip&gt;</span> is the ip address of the hub sending the command.</font></li></ul><a name=Search2></a> <h3>$Search</h3><p><font size=2>Clients are either "active", indicating they are on the Internet and can receive data directly from peers, or "passive", in which case they can communicate only through the existing connection to the server. To perform a search, an active client can send,</font></p><UL><font size=2> $Search <span class=variable>&lt;clientip&gt;</span>:<span class=variable>&lt;clientport&gt;</span> <span class=variable>&lt;searchstring&gt;</span><br>i.e. $Search 64.78.55.32:412 T?T?500000?1?madonna$ray </font></UL><ul><li><font size=2><span class=variable>&lt;clientip&gt;</span> is this client's IP address.</font></li><li><font size=2><span class=variable>&lt;clientport&gt;</span> is a UDP port on which the client is listening for responses.</font></li><li><font size=2><span class=variable>&lt;searchstring&gt;</span> is a string describing the file the client is searching for.</font></li></ul><p><font size=2><span class=variable>&lt;searchstring&gt;</span> is made up of</font></p><UL><font size=2><span class=variable>&lt;sizerestricted&gt;</span>?<span class=variable>&lt;isminimumsize&gt;</span>?<span class=variable>&lt;size&gt;</span>?<span class=variable>&lt;datatype&gt;</span>?<span class=variable>&lt;searchpattern&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;sizerestricted&gt;</span> is <span class=command>T</span> if the search should be restricted to files of a minimum or maximum size, otherwise <span class=command>F</span>.</font></li><li><font size=2><span class=variable>&lt;isminimumsize&gt;</span> is <span class=command>F</span> if <span class=variable>&lt;sizerestricted&gt;</span> is <span class=command>F</span> or if the size restriction places an upper limit on file size, otherwise <span class=command>T</span>.</font></li><li><font size=2><span class=variable>&lt;size&gt;</span> is the minimum or maximum size of the file to report (according to <span class=variable>&lt;isminimumsize&gt;</span>) if <span class=variable>&lt;sizerestricted&gt;</span> is <span class=command>T</span>, otherwise 0.</font></li><li><font size=2><span class=variable>&lt;datatype&gt;</span> restricts the search to files of a particular type. It is an integer selected from: </font><ul><li><font size=2>1 for any file type</font></li><li><font size=2>2 for audio files ("mp3", "mp2", "wav", "au", "rm", "mid", "sm")</font></li><li><font size=2>3 for compressed files ("zip", "arj", "rar", "lzh", "gz", "z", "arc", "pak")</font></li><li><font size=2>4 for documents ("doc", "txt", "wri", "pdf", "ps", "tex")</font></li><li><font size=2>5 for executables ("pm", "exe", "bat", "com")</font></li><li><font size=2>6 for pictures ("gif", "jpg", "jpeg", "bmp", "pcx", "png", "wmf", "psd")</font></li><li><font size=2>7 for video ("mpg", "mpeg", "avi", "asf", "mov")</font></li><li><font size=2>8 for folders</font></li></ul><li><font size=2><span class=variable>&lt;searchpattern&gt;</span> is used other users to determine if any files match. It is of the form: </font><UL><font size=2><span class=variable>&lt;term1&gt;</span>$<span class=variable>&lt;term2&gt;</span>$<span class=variable>&lt;term3&gt;</span>$...$ </font></UL><font size=2>where <span class=variable>&lt;term1&gt;</span>, <span class=variable>&lt;term2&gt;</span>, ... are search terms; normally, each search term is a space-delimited word entered by the user. Each search term is followed by a <span class=command>$</span>, and after the last search term there is a total of two <span class=command>$</span>.</font></li></ul><a name=ConnectToMe2></a> <h3>$ConnectToMe</h3><p><font size=2>This message sends the server to each linked server, when a user sends the <span class=command>$MultiConnectToMe</span> message.</font></p><UL><font size=2> $ConnectToMe <span class=variable>&lt;remotenick&gt;</span> <span class=variable>&lt;senderip&gt;</span>:<span class=variable>&lt;senderport&gt;</span> </font></UL><ul><li><font size=2><span class=variable>&lt;remotenick&gt;</span> is the nick who we would like to connect to.</font></li><li><font size=2><span class=variable>&lt;senderip&gt;</span> is our external ip address.</font></li><li><font size=2><span class=variable>&lt;senderport&gt;</span> is the port we are listening on.</font></li></ul><hr><p><a name=CommandTypesExperimental></a></p><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Command Types (Experimental)</h2><p><font size=2>The fallowing commands are experimental and many have not been implemented yet. I feel that these commands are required to combat the level of fake sharing on the network.<br>The following section describes the format of the Commands, Each field is denoted with <span class=variable>&lt; &gt;</span>.<br>The fields in the command are separated by a single space character (ASCII 32).<br>And each Command ends with a <span class=command>|</span> (pipe). All Commands are case sensitive.</font></p><a name=MyINFO2></a> <h3>$MyINFO</h3><p><font size=2>This is a modified version of the <span class=command>$MyINFO</span> command that I feel will be useful.</font></p><UL><font size=2> $MyINFO $ALL <span class=variable>&lt;nick&gt;</span> <span class=variable>&lt;interest&gt;</span>$ $<span class=variable>&lt;speed&gt;</span>$<span class=variable>&lt;e-mail&gt;</span>$<span class=variable>&lt;sharesize&gt;</span>$<span class=variable>&lt;slots&gt;</span>$<span class=variable>&lt;onlinetime&gt;</span>$ </font></UL><ul><li><font size=2><span class=variable>&lt;nick&gt;</span> is the client's nick.</font></li><li><font size=2><span class=variable>&lt;interest&gt;</span> is a string describing the user's interest and may be empty (All characters except $ and | are allowed).</font></li><li><font size=2><span class=variable>&lt;speed&gt;</span> is a string describing the client's internet connection selected from "56Kbps", "Satellite", "DSL", "Cable", "LAN(T1)", and "LAN(T3)" followed by a byte indicating the speed class. The value of the byte is selected from at least 1 for 56Kbps, 3 for cable or DSL, or 7, also for DSL.</font></li><li><font size=2><span class=variable>&lt;e-mail&gt;</span> is nick's e-mail address and may be "".</font></li><li><font size=2><span class=variable>&lt;sharesize&gt;</span> is the number of bytes this client shares as a string.</font></li><li><font size=2><span class=variable>&lt;slots&gt;</span> is the nuber of free slots / the total slots.</font></li><li><font size=2><span class=variable>&lt;onlinetime&gt;</span> is the time the client application is online. The format should be Days:Hours:Minutes</font>.</li></ul><a name=SupportsBZList></a><h3>$Supports BZList</h3><p><font size=2>This command is currently supported by DC++ to notify the downloading client that a BZList is available if their are no free slots.</font></p><UL><font size=2> $Supports <span class=variable>BZList</span> </font></UL><p><font size=2>Currently this command is only sent in the Client to Client communication and is sent by the client that is being connected to immediately after the <span class=command>$Lock</span> command.</font></p><p><font size=2>To improve apon this design I belive that this command should be refined in its use. For instance, if this command is sent the client should send a BZList regardless of the free slots status. The old style DCLst should only be sent if the client does not support BZLists.</font></p><hr><a name=AppendixA></a><p><a href="#Introduction">Introduction / Contents</a>&gt;</p><h2>Appendix A: Converting a Lock into a Key</h2><p><font size=2>As part of the initial negotiation between the client and hub, the hub sends a <span class=command>$Lock <span class=variable>&lt;lock&gt;</span> Pk=<span class=variable>&lt;pk&gt;</span> </span> command and the client must respond with a <span class=command>$Key <span class=variable>&lt;key&gt;</span></span> command. Until the DCN encoding, which we'll discuss last, the <span class=variable>&lt;key&gt;</span> has exactly as many characters as the <span class=variable>&lt;lock&gt;</span>. </font></p><p><font size=2>Except for the first, each <TT>key</TT> character is computed from the corresponding <TT>lock</TT> character and the one before it. If the first character has index 0 and the lock has a length of <TT>len</TT> then:</font></p><pre><font size="2">
for (i = 1; i &lt; len; i++)
	key[i] = lock[i] xor lock[i-1];</font></pre><p><font size=2>The first key character is calculated from the first lock character and the last two lock characters:</font></p><pre><font size="2">
key[0] = lock[0] xor lock[len-1] xor lock[len-2] xor 5</font></pre><p><font size=2>Next, every character in the key must be nibble-swapped:</font></p><pre><font size="2">
for (i = 0; i &lt; len; i++)
	key[i] = ((key[i]&lt;&lt;4) &amp; 240) | ((key[i]&gt;&gt;4) &amp; 15)</font></pre><p><font size=2>Finally, the characters with the decimal ASCII values of 0, 5, 36, 96, 124, and 126 cannot be sent to the server. Each character with this value must be substituted with the string <span class=command>/%DCN000%/</span>, <span class=command>/%DCN005%/</span>, <span class=command>/%DCN036%/</span>, <span class=command>/%DCN096%/</span>, <span class=command>/%DCN124%/</span>, or <span class=command>/%DCN126%/</span>, respectively. The resulting string is the key to be sent to the server.</font></p><p><font size=2>If your programming language of choice doesn't have xor or shift operations on characters, convert them to integers. If it doesn't have a bit shift at all, then <TT>x &lt;&lt; y = x*(2**y)</TT> and <TT>x &gt;&gt; y = x/(2**y)</TT> for all integers <TT>x</TT> and <TT>y</TT> (<TT>**</TT> is the exponent operation or "to the power of"). Be sure to use unsigned values everywhere and do not do sign extension. Shift operations always lose the high or low bit (they are not roll operations!). The <TT>&amp;</TT> (and) and <TT>|</TT> (or) operations are all logical, not boolean (eg. <TT>6 &amp; 13 = 4</TT>, not <TT>1</TT>).</font></p><p><font size=2>When the hub connects to the hublist, it must undergo a similar Lock/Key negotiation. The <span class=variable>&lt;key&gt;</span> calculation is the same, but the special number 5 in the second step is replaced with the following value is not computed from the hub's listening port, but rather the random outgoing port that the winsock selects. <TT>localport</TT>:</font></p><p><font size=2><TT> ((localport>>8) + (localport & 255)) & 255 </TT></font></p><hr><a name=AppendixB></a><p>&lt;<a href="#Introduction">Introduction </a>/ <a href="#Contents">Contents</a>&gt;</p><h2>Appendix B: Creating a Lock</h2><p><font size=2>Creating a Lock is much easier than decoding one. There are only a few things to keep in mind when creating a Lock. </font></p><p><font size=2>First the Lock should be between 80 and 134 ascii characters long but it does not have to be. </font></p><p><font size=2>Second the Pk should always be 16 ascii characters long but like the lock this is just a suggested length. </font></p><p><font size=2>Third the characters with the decimal ASCII values of 0, 5, 36, 96, 124, and 126 must be substituted with the string<br><span class=command>/%DCN000%/</span>, <span class=command>/%DCN005%/</span>, <span class=command>/%DCN036%/</span>, <span class=command>/%DCN096%/</span>, <span class=command>/%DCN124%/</span>, or <span class=command>/%DCN126%/</span>, respectively. </font></p><p><font size=2>First we must create the actual Lock you can use random ascii characters for this. </font></p><pre><font size="2">for(int i = 0; i &lt; RandLenOfLock; i++)
{
	lock[i] = (char)(94.0 * Math.random() + 33);
}</font></pre><p><font size=2>Now that the lock has been created lets create our Pk. Because there are so many Direct Connect clients popping up its probably a good idea to include your client type and version instead of a random Pk. </font></p><pre><font size="2">for(int i = 0; i &lt; 16; i++)
{
	pk[i] = (char)(94.0 * Math.random() + 33);
}</font></pre><p><font size=2>There you go now all you have to do is send the data using the correct syntax.</font></p></body></html>